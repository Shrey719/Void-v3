<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="icon" type="image/png" href="https://ssl.gstatic.com/classroom/favicon.png">
    <title>New Tab</title>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VXDP7XC98T"></script>
    <script src="/assets/js/ads.js"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());
        gtag('config', 'G-VXDP7XC98T');
    </script>

    <link rel="stylesheet" href="/assets/css/styles.css" type="text/css">
    <script src="/global.js"></script>
    <script src="/config.js"></script>

    <!-- UV things -->
    <script src="uv/uv.bundle.js"></script>
    <script src="uv/uv.config.js"></script>

    <style>
        /* Your existing styles here */
        #particles-js {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            padding: 0;
            margin: 0;
        }

        .widget-section {
            width: 95%;
            max-width: 1200px;
            height: 80%;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        #widgetbot-container {
            flex: 1;
            border: none;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        #error-message {
            color: white;
            text-align: center;
            padding: 20px;
        }

        @media (max-width: 800px) {
            .widget-section {
                height: auto;
                padding-bottom: 75%;
            }

            #widgetbot-container {
                height: 100%;
            }
        }
    </style>
</head>

<body>
    <!-- Google Tag Manager -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PZXRTFX5" height="0" width="0"
            style="display:none;visibility:hidden"></iframe>
    </noscript>

    <!-- Particle Background -->
    <div id="particles-js"></div>
    <script src="/assets/js/particles.js"></script>
    <script>
        particlesJS.load('particles-js', '/assets/json/particles.json');
    </script>

    <!-- Dynamically Loaded Header -->
    <div id="header"></div>

    <!-- Main Content -->
    <div class="container">
        <div class="widget-section">
            <div id="widgetbot-container">
                <div id="error-message"></div>
            </div>
        </div>
    </div>

    <!-- Dynamically Loaded Footer -->
    <div id="footer"></div>

    <script>
        function loadHTML(url, elementId) {
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.text();
                })
                .then(data => {
                    document.getElementById(elementId).innerHTML = data;
                })
                .catch(error => {
                    console.error('Error loading HTML:', error);
                    document.getElementById(elementId).innerHTML = `<p>Error loading content: ${error.message}</p>`;
                });
        }

        // Load header and footer
        loadHTML("/assets/html/header.html", "header");
        loadHTML("/assets/html/footer.html", "footer");

        // Function to load WidgetBot through proxy
        function loadProxiedWidgetBot() {
            console.log("Attempting to load WidgetBot...");
            const widgetBotUrl = 'https://cdn.jsdelivr.net/npm/@widgetbot/html-embed';
            
            if (typeof __uv$config === 'undefined' || typeof __uv$config.prefix === 'undefined' || typeof __uv$config.encodeUrl === 'undefined') {
                console.error("UV config not found. Make sure uv.config.js is loaded correctly.");
                document.getElementById('error-message').innerText = "Error: UV config not found. Please refresh the page or contact support.";
                return;
            }

            const proxiedUrl = __uv$config.prefix + __uv$config.encodeUrl(widgetBotUrl);
            console.log("Proxied URL:", proxiedUrl);

            const script = document.createElement('script');
            script.src = proxiedUrl;
            script.onload = () => {
                console.log("WidgetBot script loaded successfully.");
                if (typeof window.WidgetBot === 'undefined' || typeof window.WidgetBot.default === 'undefined') {
                    console.error("WidgetBot not found in window object.");
                    document.getElementById('error-message').innerText = "Error: WidgetBot failed to load. Please refresh the page or try again later.";
                    return;
                }
                new window.WidgetBot.default({
                    server: '1205329363394887722',
                    channel: '1205332504220012584'
                }).mount(document.getElementById('widgetbot-container'));
            };
            script.onerror = (error) => {
                console.error("Error loading WidgetBot script:", error);
                document.getElementById('error-message').innerText = "Error loading WidgetBot. Please refresh the page or try again later.";
            };
            document.body.appendChild(script);
        }

        // Load WidgetBot when the page is ready
        window.addEventListener('load', loadProxiedWidgetBot);
    </script>
</body>

</html>
