<!DOCTYPE html>
<html>
<head>
  <script src="/assets/js/favicon-handler.js"></script>
  <link id="favicon" rel="icon" href="https://ssl.gstatic.com/classroom/favicon.png">
  <script src="/assets/js/ads.js"></script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VXDP7XC98T"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-VXDP7XC98T');
  </script>

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-PZXRTFX5');</script>
  <!-- End Google Tag Manager -->
  <style>
    .uvsearch {
        width: 30rem;
        padding: 1rem;
        border: none;
        border-radius: 10rem;
        margin-bottom: 10rem;
        text-align: center;
        display: block;
        margin-left: auto;
        margin-right: auto;
        font-size: 1.5rem;
    }
    .centered_div {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }
    .loading {
        display: none;
        text-align: center;
        color: white;
        font-size: 1.5rem;
    }
  </style>
</head>
<body>
  <!-- Scripts -->
  <script src="uv/uv.bundle.js"></script>
  <script src="uv/uv.config.js"></script> 
  <script src="/config.js"></script>
  <script src="/global.js"></script>
  <script src="/assets/js/particles.js"></script>
  <script src="/assets/js/adblock.js"></script>
  <script>
    loadHTML("/assets/html/header.html", "header")
    loadHTML("/assets/html/footer.html", "footer")

    const stockSW = "/uv/sw.js";
    const swAllowedHostnames = ["localhost", "127.0.0.1"];
    let debounceTimeout;

    function handleSearch(event) {
      if (event.key === 'Enter') {
        event.preventDefault();
        console.log("Enter key pressed, performing search...");
        performSearch();
      }
    }

    function debounce(func, delay) {
      return function(...args) {
        clearTimeout(debounceTimeout);
        debounceTimeout = setTimeout(() => func.apply(this, args), delay);
      };
    }

    const performSearch = debounce(function() {
      const searchInput = document.getElementById('uvsearch');
      const searchVal = searchInput.value.trim();
      console.log("Search value:", searchVal); // Log the search value
      let src;

      if (searchVal.includes("http") && searchVal.includes(":")) {
        src = '/uv/service/' + __uv$config.encodeUrl(searchVal);
      } else if (searchVal.includes(".") && !searchVal.includes(" ")) {
        src = '/uv/service/' + __uv$config.encodeUrl("https://" + searchVal);
      } else {
        src = '/uv/service/' + __uv$config.encodeUrl("https://google.com/search?q=" + searchVal);
      }

      console.log("Iframe source URL:", src); // Log the iframe source URL

      document.getElementById('stag').remove();
      searchInput.remove();
      
      // Show loading indicator
      document.getElementById('loading').style.display = 'block';

      var iframe = document.createElement("iframe");
      iframe.style.border = 'none';
      iframe.style.width = '100%';
      iframe.style.height = '100%';
      iframe.style.margin = '0';
      iframe.src = src;
      iframe.style.padding = '0.5px';
      iframe.style.position = 'fixed';
      iframe.style.display = 'block';
      document.getElementById('div_uvout').appendChild(iframe);

      // Hide loading indicator after iframe is loaded
      iframe.onload = function() {
        document.getElementById('loading').style.display = 'none';
      };
    }, 500); // Debounce for 500ms

    function registerSW() {
      if (!navigator.serviceWorker) {
        if (
          location.protocol !== "https:" &&
          !swAllowedHostnames.includes(location.hostname)
        )
          throw new Error("Service workers cannot be registered without https.");
        document.write("</p>UV ERROR: Unable to register serviceworker - Serviceworkers cannot be registered without HTTPS</p>")
        throw new Error("Your browser doesn't support service workers.");
      }
      
      navigator.serviceWorker.register(stockSW);
    }
    registerSW();   
  </script>

  <link href="assets/css/styles.css" rel="stylesheet">

  <div id="header"></div>
  <div id="footer"></div>
  <div class="centered_div">
    <h1 style="text-align: center; color: white;" id="stag">Search the web</h1>
    <input class="uvsearch" id="uvsearch" onkeypress="handleSearch(event)" placeholder="Enter your search...">
    <div class="loading" id="loading">Loading...</div>
  </div>
  <div style="line-height:4vh;">
    <br>
  </div>
  <div id="div_uvout" class="div_tab">
    <title>New Tab</title>  
  </div>

  <script>
    document.body.style.margin = '0';
    document.body.style.height = '100vh';
  </script>
</body>
</html>
