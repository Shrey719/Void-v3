<!DOCTYPE html>
<html>
<head>
    <title>Classes</title>
    
    <!-- Immediate game loading optimization -->
    <script>
        // Preload game URL before anything else
        const gameUrl = localStorage.getItem('loadedG');
        if (gameUrl) {
            const preloadLink = document.createElement('link');
            preloadLink.rel = 'preload';
            preloadLink.as = 'document';
            preloadLink.href = gameUrl;
            preloadLink.fetchPriority = 'high';
            document.head.appendChild(preloadLink);
        }
    </script>

    <!-- Critical game container styles only -->
    <style>
        .game_container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: min(90vw, 1280px);
            aspect-ratio: 16/9;
            height: auto;
            max-height: 80vh;
            z-index: 1;
            background: #2a2a2a;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
        }

        .game_iframe {
            width: 100%;
            height: calc(100% - 36px);
            border: none;
            border-radius: 10px 10px 0 0;
            background-color: #1a1a1a;
            z-index: 1;
        }

        /* Hide UI initially for faster game load */
        .header, .footer {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
    </style>

    <!-- Defer non-critical styles -->
    <link rel="stylesheet" href="data:text/css;base64,..." media="print" onload="this.media='all'">
</head>
<body>
    <div class="game_container">
        <iframe class="game_iframe" id="gframe" allow="fullscreen; autoplay; keyboard" allowfullscreen></iframe>
        <div class="footer">
            <button class="fullscreen_button" onclick="toggleFullScreen()">
                <img src="/nav/fullscreenbutton.png" alt="Fullscreen">
            </button>
            <button class="reload_button" onclick="reloadGame()">
                <img src="/nav/reload.png" alt="Reload">
            </button>
            <button class="flash_button" onclick="toggleFlashlight()">
                <img src="/nav/flash.png" alt="Flashlight">
            </button>
            <button class="chat_button" onclick="toggleChat()">
                <img src="/nav/chat_icon.png" alt="Chat">
            </button>
        </div>
    </div>

    <header class="header">
        <a href="/"><img src="/nav/home.png" alt="Home"></a>
        <a href="/ta"><img src="/nav/search.png" alt="Search"></a>
        <a href="/app"><img src="/nav/apps.png" alt="Apps"></a>
    </header>

    <!-- Critical game loading script -->
    <script>
        (function() {
            const iframe = document.getElementById('gframe');
            const gameUrl = localStorage.getItem('loadedG');
            
            // Immediately start loading the game
            if (gameUrl) {
                iframe.src = gameUrl;
            }

            // Priority loading sequence
            const loadSequence = () => {
                // 1. Load game
                if (gameUrl) {
                    iframe.addEventListener('load', () => {
                        // 2. Show UI elements only after game loads
                        requestAnimationFrame(() => {
                            // Load non-critical styles
                            loadNonCriticalStyles();
                            // Show UI elements
                            document.querySelector('.header').style.opacity = '1';
                            document.querySelector('.footer').style.opacity = '1';
                        });
                    }, { once: true });
                }
            };

            // Start loading sequence
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', loadSequence);
            } else {
                loadSequence();
            }
        })();

        // Load remaining styles after game loads
        function loadNonCriticalStyles() {
            const style = document.createElement('style');
            style.textContent = `
                body {
                    background-color: #121212;
                    margin: 0;
                    padding: 0;
                    height: 100vh;
                    overflow: hidden;
                }

                .header {
                    position: fixed;
                    width: 100%;
                    background: linear-gradient(90deg, rgba(41,41,41,0.9) 0%, rgba(61,61,61,0.9) 50%, rgba(41,41,41,0.9) 100%);
                    color: white;
                    left: 0;
                    padding: 1rem;
                    top: 0;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10;
                }

                .footer {
                    height: 36px;
                    background-color: #2a2a2a;
                    border-radius: 0 0 15px 15px;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    gap: 10px;
                }

                .header a {
                    margin: 0 1.5rem;
                }

                .header img {
                    height: 3vh;
                    width: 3vh;
                }

                .fullscreen_button, 
                .reload_button, 
                .flash_button, 
                .chat_button {
                    width: 36px;
                    height: 36px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    background: transparent;
                    border: none;
                    cursor: pointer;
                    padding: 6px;
                }

                .fullscreen_button img, 
                .reload_button img, 
                .flash_button img, 
                .chat_button img {
                    width: 24px;
                    height: 24px;
                }
            `;
            document.head.appendChild(style);
        }

        // Core functionality
        const gameContainer = document.querySelector('.game_container');
        const iframe = document.getElementById('gframe');

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                gameContainer.requestFullscreen().catch(err => {
                    console.warn('Error attempting to enable fullscreen:', err);
                });
            } else {
                document.exitFullscreen().catch(err => {
                    console.warn('Error attempting to exit fullscreen:', err);
                });
            }
        }

        function reloadGame() {
            const currentSrc = iframe.src;
            iframe.src = 'about:blank';
            requestAnimationFrame(() => {
                iframe.src = currentSrc;
            });
        }
    </script>

    <!-- Load non-critical scripts after game loads -->
    <script defer>
        window.addEventListener('load', () => {
            // Load external scripts
            const scripts = [
                '//acscdn.com/script/aclib.js',
                'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4845994519357732'
            ];
            
            scripts.forEach(src => {
                const script = document.createElement('script');
                script.src = src;
                script.async = true;
                document.body.appendChild(script);
            });

            // Initialize ads after everything else
            setTimeout(() => {
                if (window.aclib) {
                    aclib.runInterstitial({ zoneId: '9014502' });
                }
            }, 1000);
        });
    </script>
</body>
</html>
